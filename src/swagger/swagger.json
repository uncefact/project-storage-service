{
  "openapi": "3.0.0",
  "info": {
    "title": "Storage Service API"
  },
  "servers": [],
  "security": [
    {
      "ApiKeyAuth": []
    }
  ],
  "paths": {
    "/public": {
      "post": {
        "summary": "Store public data without encryption.",
        "description": "Store public data that does not require encryption. This endpoint accepts both JSON documents (application/json) and binary files (multipart/form-data). Data is stored as-is without any encryption applied. Returns a URI (the location of your stored data) and a hash (a fingerprint to verify the data has not been altered).",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StoreDocumentRequest"
              },
              "examples": {
                "example1": {
                  "$ref": "#/components/examples/ExampleRequest1"
                },
                "example2": {
                  "$ref": "#/components/examples/ExampleRequest2"
                }
              }
            },
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/StoreFileRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Data stored successfully. Returns the storage location and integrity hash.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "uri": {
                      "type": "string",
                      "description": "The location where your data is stored.",
                      "example": "http://localhost:3333/api/2.0.0/verifiable-credentials/123e4567-e89b-12d3-a456-426614174000.json"
                    },
                    "hash": {
                      "type": "string",
                      "description": "A fingerprint to verify the data has not been altered.",
                      "example": "computed-hash"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "409": {
            "$ref": "#/components/responses/409"
          },
          "413": {
            "description": "Payload Too Large. The uploaded file exceeds the maximum allowed size.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "File exceeds the maximum allowed size."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/500"
          }
        }
      }
    },
    "/private": {
      "post": {
        "summary": "Store private data with automatic encryption.",
        "description": "Store private data with automatic encryption. This endpoint accepts both JSON documents (application/json) and binary files (multipart/form-data). Data is automatically encrypted before storage — you do not need to encrypt it yourself. Binary files are base64-encoded before encryption. The encrypted envelope includes a `contentType` field so consumers can determine the original format.\n\nThe response includes a URI (the location of your stored data), a hash (a fingerprint to verify the data has not been altered), and a decryptionKey (your unique decryption key).\n\n**Important**: Save the decryption key securely. Without it, your data cannot be decrypted — **not even by us**.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StoreDocumentRequest"
              },
              "examples": {
                "example1": {
                  "$ref": "#/components/examples/ExampleRequest1"
                },
                "example2": {
                  "$ref": "#/components/examples/ExampleRequest2"
                }
              }
            },
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/StoreFileRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Data encrypted and stored successfully. Returns the storage location, integrity hash, and decryption key.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "uri": {
                      "type": "string",
                      "description": "The location where your encrypted data is stored.",
                      "example": "http://localhost:3333/api/2.0.0/verifiable-credentials/123e4567-e89b-12d3-a456-426614174000.json"
                    },
                    "hash": {
                      "type": "string",
                      "description": "A fingerprint to verify the data has not been altered.",
                      "example": "computed-hash"
                    },
                    "decryptionKey": {
                      "type": "string",
                      "description": "Your unique decryption key. **Important**: Save this securely. It is required to decrypt your data and **cannot be recovered if lost**.",
                      "example": "encryption-key"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "409": {
            "$ref": "#/components/responses/409"
          },
          "413": {
            "description": "Payload Too Large. The uploaded file exceeds the maximum allowed size.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "File exceeds the maximum allowed size."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/500"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "StoreDocumentRequest": {
        "type": "object",
        "properties": {
          "bucket": {
            "type": "string",
            "example": "verifiable-credentials"
          },
          "data": {
            "type": "object",
            "properties": {
              "field1": {
                "type": "string",
                "example": "value1"
              },
              "field2": {
                "type": "string",
                "example": "value2"
              }
            }
          },
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "123e4567-e89b-12d3-a456-426614174000",
            "description": "Optional UUID for the document. If not provided, one will be generated."
          }
        },
        "required": [
          "bucket",
          "data"
        ]
      },
      "StoreFileRequest": {
        "type": "object",
        "required": [
          "file",
          "bucket"
        ],
        "properties": {
          "file": {
            "type": "string",
            "format": "binary",
            "description": "The binary file to upload."
          },
          "bucket": {
            "type": "string",
            "description": "Name of the bucket where the file will be stored.",
            "example": "files"
          },
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Optional UUID for the file. If not provided, one will be generated.",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        }
      }
    },
    "examples": {
      "ExampleRequest1": {
        "summary": "Verifiable Credential",
        "value": {
          "bucket": "verifiable-credentials",
          "id": "123e4567-e89b-12d3-a456-426614174000",
          "data": {
            "@context": [
              "https://www.w3.org/ns/credentials/v2",
              "https://www.w3.org/ns/credentials/examples/v2"
            ],
            "id": "http://example.gov/credentials/3732",
            "type": [
              "VerifiableCredential",
              "ExampleDegreeCredential"
            ],
            "issuer": "did:example:6fb1f712ebe12c27cc26eebfe11",
            "validFrom": "2010-01-01T19:23:24Z",
            "credentialSubject": {
              "id": "https://subject.example/subject/3921",
              "degree": {
                "type": "ExampleBachelorDegree",
                "name": "Bachelor of Science and Arts"
              }
            },
            "proof": {
              "type": "DataIntegrityProof",
              "cryptosuite": "eddsa-rdfc-2022",
              "created": "2021-11-13T18:19:39Z",
              "verificationMethod": "https://university.example/issuers/14#key-1",
              "proofPurpose": "assertionMethod",
              "proofValue": "z58DAdFfa9SkqZMVPxAQp...jQCrfFPP2oumHKtz"
            }
          }
        }
      },
      "ExampleRequest2": {
        "summary": "Enveloped Verifiable Credential",
        "value": {
          "bucket": "verifiable-credentials",
          "id": "123e4567-e89b-12d3-a456-426614174001",
          "data": {
            "@context": [
              "https://www.w3.org/ns/credentials/v2",
              "https://www.w3.org/ns/credentials/examples/v2"
            ],
            "id": "data:application/vc+jwt,eyJraWQiOiJFeEhrQk1XOWZtYmt2VjI2Nm1ScHVQMnNVWV9OX0VXSU4xbGFwVXpPOHJvIiwiYWxnIjoiRVMyNTYifQ .eyJAY29udGV4dCI6WyJodHRwczovL3d3dy53My5vcmcvbnMvY3JlZGVudGlhbHMvdjIiLCJodHRwczovL3d3dy53My5vcmcvbnMvY3JlZGVudGlhbHMvZXhhbXBsZXMvdjIiXSwiaWQiOiJodHRwOi8vdW5pdmVyc2l0eS5leGFtcGxlL2NyZWRlbnRpYWxzLzE4NzIiLCJ0eXBlIjpbIlZlcmlmaWFibGVDcmVkZW50aWFsIiwiRXhhbXBsZUFsdW1uaUNyZWRlbnRpYWwiXSwiaXNzdWVyIjoiaHR0cHM6Ly91bml2ZXJzaXR5LmV4YW1wbGUvaXNzdWVycy81NjUwNDkiLCJ2YWxpZEZyb20iOiIyMDEwLTAxLTAxVDE5OjIzOjI0WiIsImNyZWRlbnRpYWxTY2hlbWEiOnsiaWQiOiJodHRwczovL2V4YW1wbGUub3JnL2V4YW1wbGVzL2RlZ3JlZS5qc29uIiwidHlwZSI6Ikpzb25TY2hlbWEifSwiY3JlZGVudGlhbFN1YmplY3QiOnsiaWQiOiJkaWQ6ZXhhbXBsZToxMjMiLCJkZWdyZWUiOnsidHlwZSI6IkJhY2hlbG9yRGVncmVlIiwibmFtZSI6IkJhY2hlbG9yIG9mIFNjaWVuY2UgYW5kIEFydHMifX19 .vLtI6zKqEquVX-2RPhGyvHzQ9xdKOdFGRoFaEnG-UhQMGG7OGPi0WAoKPrj8OiT-LDcLMAUNKPncwPc8B-lqKg",
            "type": "EnvelopedVerifiableCredential"
          }
        }
      }
    },
    "responses": {
      "400": {
        "description": "The request is invalid.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "Bucket is required. Please provide a bucket name."
                }
              }
            }
          }
        }
      },
      "401": {
        "description": "Unauthorized. Invalid or missing API key.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "API key is required. Please provide a valid API key in the X-API-Key header."
                }
              }
            }
          }
        }
      },
      "409": {
        "description": "A resource with the provided ID already exists in the specified bucket.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "A resource with the provided ID already exists in the specified bucket."
                }
              }
            }
          }
        }
      },
      "500": {
        "description": "An unexpected error occurred while storing the resource.",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "An unexpected error occurred while storing the resource."
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API key for authentication. Required for all upload operations."
      }
    }
  }
}