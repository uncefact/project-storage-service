"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[8110],{248:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"migration-guides/migrating-to-3","title":"Migrating to 3.0.0","description":"This guide is for users upgrading from version 2.x to 3.0.0. It covers all breaking changes, including endpoint consolidation, environment variable renames, and infrastructure updates. Work through each section to ensure a smooth transition.","source":"@site/versioned_docs/version-3.0.0/migration-guides/migrating-to-3.md","sourceDirName":"migration-guides","slug":"/migration-guides/migrating-to-3","permalink":"/project-storage-service/docs/migration-guides/migrating-to-3","draft":false,"unlisted":false,"editUrl":"https://github.com/uncefact/project-storage-service/tree/next/versioned_docs/version-3.0.0/migration-guides/migrating-to-3.md","tags":[],"version":"3.0.0","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Migrating to 3.0.0"},"sidebar":"tutorialSidebar","previous":{"title":"Scaling","permalink":"/project-storage-service/docs/deployment-guide/scaling/"},"next":{"title":"Development Setup","permalink":"/project-storage-service/docs/contributing/development-setup/"}}');var s=i(4848),t=i(8453);const d={sidebar_position:1,title:"Migrating to 3.0.0"},o=void 0,l={},c=[{value:"API Endpoint Changes",id:"api-endpoint-changes",level:2},{value:"Before (2.x)",id:"before-2x",level:3},{value:"After (3.0.0)",id:"after-300",level:3},{value:"Migration steps",id:"migration-steps",level:3},{value:"Response Field Rename",id:"response-field-rename",level:2},{value:"Environment Variable Changes",id:"environment-variable-changes",level:2},{value:"Renamed variables",id:"renamed-variables",level:3},{value:"Changed default bucket names",id:"changed-default-bucket-names",level:3},{value:"Node.js Version",id:"nodejs-version",level:2},{value:"Repository Rename",id:"repository-rename",level:2},{value:"Git remotes",id:"git-remotes",level:3},{value:"Docker images",id:"docker-images",level:3},{value:"GitHub Pages",id:"github-pages",level:3},{value:"What redirects",id:"what-redirects",level:3},{value:"What does not redirect",id:"what-does-not-redirect",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This guide is for users upgrading from version 2.x to 3.0.0. It covers all breaking changes, including endpoint consolidation, environment variable renames, and infrastructure updates. Work through each section to ensure a smooth transition."}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoint-changes",children:"API Endpoint Changes"}),"\n",(0,s.jsx)(n.p,{children:"The three separate endpoints have been consolidated into two, organised by data sensitivity rather than content type."}),"\n",(0,s.jsx)(n.h3,{id:"before-2x",children:"Before (2.x)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /api/2.0.0/documents"})}),(0,s.jsx)(n.td,{children:"Store public JSON data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /api/2.0.0/files"})}),(0,s.jsx)(n.td,{children:"Store public binary files"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /api/2.0.0/credentials"})}),(0,s.jsx)(n.td,{children:"Store and encrypt private JSON data"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"after-300",children:"After (3.0.0)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /api/3.0.0/public"})}),(0,s.jsx)(n.td,{children:"Store public data (JSON or binary)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST /api/3.0.0/private"})}),(0,s.jsx)(n.td,{children:"Store and encrypt private data (JSON or binary)"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What changed:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/documents"})," and ",(0,s.jsx)(n.code,{children:"/files"})," are merged into ",(0,s.jsx)(n.code,{children:"/public"}),". It accepts both ",(0,s.jsx)(n.code,{children:"application/json"})," and ",(0,s.jsx)(n.code,{children:"multipart/form-data"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/credentials"})," is renamed to ",(0,s.jsx)(n.code,{children:"/private"}),". It now also accepts ",(0,s.jsx)(n.code,{children:"multipart/form-data"})," (binary files are base64-encoded before encryption)."]}),"\n",(0,s.jsxs)(n.li,{children:["The API version in the path changed from ",(0,s.jsx)(n.code,{children:"2.0.0"})," to ",(0,s.jsx)(n.code,{children:"3.0.0"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"migration-steps",children:"Migration steps"}),"\n",(0,s.jsx)(n.p,{children:"Replace all API calls:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-diff",children:"# Public JSON data\n- POST /api/2.0.0/documents\n+ POST /api/3.0.0/public\n\n# Public binary files\n- POST /api/2.0.0/files\n+ POST /api/3.0.0/public\n\n# Private data (JSON or binary)\n- POST /api/2.0.0/credentials\n+ POST /api/3.0.0/private\n"})}),"\n",(0,s.jsx)(n.h2,{id:"response-field-rename",children:"Response Field Rename"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"/private"})," endpoint response field for the decryption key has been renamed for clarity."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Before (2.x)\n{\n    "uri": "...",\n    "hash": "...",\n    "key": "..."\n}\n\n// After (3.0.0)\n{\n    "uri": "...",\n    "hash": "...",\n    "decryptionKey": "..."\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["Update any code that reads the ",(0,s.jsx)(n.code,{children:"key"})," field from ",(0,s.jsx)(n.code,{children:"/credentials"})," responses to use ",(0,s.jsx)(n.code,{children:"decryptionKey"})," from ",(0,s.jsx)(n.code,{children:"/private"})," responses instead. Failing to update this will cause errors wherever decryption keys are parsed from the API response."]})}),"\n",(0,s.jsx)(n.h2,{id:"environment-variable-changes",children:"Environment Variable Changes"}),"\n",(0,s.jsx)(n.h3,{id:"renamed-variables",children:"Renamed variables"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Before (2.x)"}),(0,s.jsx)(n.th,{children:"After (3.0.0)"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAX_BINARY_FILE_SIZE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAX_UPLOAD_SIZE"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"10485760"})," (10 MB)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ALLOWED_BINARY_TYPES"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ALLOWED_UPLOAD_TYPES"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"image/png,image/jpeg,image/webp,application/pdf"})})]})]})]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["The old variable names are no longer recognised. Update your ",(0,s.jsx)(n.code,{children:".env"})," files and deployment configurations before upgrading."]})}),"\n",(0,s.jsxs)(n.p,{children:["For the full list of environment variables and their defaults, see ",(0,s.jsx)(n.a,{href:"../deployment-guide/configuration/",children:"Configuration"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"changed-default-bucket-names",children:"Changed default bucket names"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Before (2.x)"}),(0,s.jsx)(n.th,{children:"After (3.0.0)"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEFAULT_BUCKET=verifiable-credentials"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DEFAULT_BUCKET=documents"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AVAILABLE_BUCKETS=verifiable-credentials,files,private-verifiable-credentials"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AVAILABLE_BUCKETS=documents,files"})})]})]})]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["If you already set ",(0,s.jsx)(n.code,{children:"DEFAULT_BUCKET"})," and ",(0,s.jsx)(n.code,{children:"AVAILABLE_BUCKETS"})," explicitly in your configuration, no change is needed. This only affects deployments relying on the default values."]})}),"\n",(0,s.jsx)(n.h2,{id:"nodejs-version",children:"Node.js Version"}),"\n",(0,s.jsxs)(n.p,{children:["The minimum Node.js version is now ",(0,s.jsx)(n.strong,{children:"22"})," (previously 18). Update your runtime environment, CI pipelines, and Docker base images accordingly."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"../deployment-guide/installation/",children:"Installation"})," for up-to-date prerequisites and setup instructions."]}),"\n",(0,s.jsx)(n.h2,{id:"repository-rename",children:"Repository Rename"}),"\n",(0,s.jsxs)(n.p,{children:["The repository has been renamed from ",(0,s.jsx)(n.code,{children:"project-identity-resolver"})," to ",(0,s.jsx)(n.code,{children:"project-storage-service"})," to reflect its actual scope."]}),"\n",(0,s.jsx)(n.h3,{id:"git-remotes",children:"Git remotes"}),"\n",(0,s.jsx)(n.p,{children:"GitHub redirects old URLs indefinitely, so existing clones continue to work. To update your remote explicitly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git remote set-url origin https://github.com/uncefact/project-storage-service.git\n"})}),"\n",(0,s.jsx)(n.h3,{id:"docker-images",children:"Docker images"}),"\n",(0,s.jsx)(n.p,{children:"Images are now published under the new repository name:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Before\ndocker pull ghcr.io/uncefact/project-identity-resolver:latest\n\n# After\ndocker pull ghcr.io/uncefact/project-storage-service:3.0.0\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["The old image name (",(0,s.jsx)(n.code,{children:"project-identity-resolver"}),") will not receive new versions. Update your deployment scripts and CI pipelines to pull from ",(0,s.jsx)(n.code,{children:"ghcr.io/uncefact/project-storage-service"}),"."]})}),"\n",(0,s.jsx)(n.h3,{id:"github-pages",children:"GitHub Pages"}),"\n",(0,s.jsxs)(n.p,{children:["Documentation has moved from ",(0,s.jsx)(n.code,{children:"uncefact.github.io/project-identity-resolver"})," to ",(0,s.jsx)(n.code,{children:"uncefact.github.io/project-storage-service"}),". The old URL redirects automatically, but you should update any bookmarks or links."]}),"\n",(0,s.jsx)(n.h3,{id:"what-redirects",children:"What redirects"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"GitHub Pages root URL (redirects to the new site, but deep links will 404)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"what-does-not-redirect",children:"What does not redirect"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Git clone, fetch, and push (the old repo name now points to a redirect-only repository)"}),"\n",(0,s.jsx)(n.li,{children:"Browser links to the old repository, issues, and pull requests"}),"\n",(0,s.jsx)(n.li,{children:"Docker image pulls (old image name will stop receiving updates)"}),"\n",(0,s.jsx)(n.li,{children:"Deep links to specific documentation pages"}),"\n",(0,s.jsx)(n.li,{children:"Any hardcoded references to the old GHCR package name in CI pipelines"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);