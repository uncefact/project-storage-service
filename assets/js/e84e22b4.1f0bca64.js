"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[1199],{6607:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"deployment-guide/storage-providers/index","title":"Storage Providers","description":"The Storage Service supports multiple storage backends. You can switch between providers by changing the STORAGE_TYPE environment variable -- no code changes are required.","source":"@site/versioned_docs/version-3.1.0/deployment-guide/storage-providers/index.md","sourceDirName":"deployment-guide/storage-providers","slug":"/deployment-guide/storage-providers/","permalink":"/project-storage-service/docs/deployment-guide/storage-providers/","draft":false,"unlisted":false,"editUrl":"https://github.com/uncefact/project-storage-service/tree/next/versioned_docs/version-3.1.0/deployment-guide/storage-providers/index.md","tags":[],"version":"3.1.0","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Storage Providers"},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/project-storage-service/docs/deployment-guide/configuration/"},"next":{"title":"Scaling","permalink":"/project-storage-service/docs/deployment-guide/scaling/"}}');var r=s(4848),i=s(8453);const t={sidebar_position:3,title:"Storage Providers"},c=void 0,d={},l=[{value:"Local Storage",id:"local-storage",level:2},{value:"Google Cloud Storage",id:"google-cloud-storage",level:2},{value:"Amazon Web Services (AWS S3)",id:"amazon-web-services-aws-s3",level:2},{value:"S3-Compatible Providers",id:"s3-compatible-providers",level:2},{value:"MinIO",id:"minio",level:3},{value:"DigitalOcean Spaces",id:"digitalocean-spaces",level:3},{value:"Cloudflare R2",id:"cloudflare-r2",level:3},{value:"S3 Configuration Reference",id:"s3-configuration-reference",level:2},{value:"Custom Public URL for Document URIs",id:"custom-public-url-for-document-uris",level:2},{value:"Example: DigitalOcean Spaces with CDN",id:"example-digitalocean-spaces-with-cdn",level:3},{value:"Example: Google Cloud Storage with Cloud CDN",id:"example-google-cloud-storage-with-cloud-cdn",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The Storage Service supports multiple storage backends. You can switch between providers by changing the ",(0,r.jsx)(n.code,{children:"STORAGE_TYPE"})," environment variable -- no code changes are required."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Local storage is for development only."})," Use a cloud provider for production deployments. Local filesystem storage does not scale beyond a single instance and data is lost if the container is removed."]})}),"\n",(0,r.jsx)(n.h2,{id:"local-storage",children:"Local Storage"}),"\n",(0,r.jsx)(n.p,{children:"Minimal configuration for local development. Files are stored on the local filesystem."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=local\nLOCAL_DIRECTORY=uploads\n"})}),"\n",(0,r.jsx)(n.h2,{id:"google-cloud-storage",children:"Google Cloud Storage"}),"\n",(0,r.jsxs)(n.p,{children:["Update your ",(0,r.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=gcp\nGOOGLE_APPLICATION_CREDENTIALS=/tmp/service-account-file.json\n"})}),"\n",(0,r.jsx)(n.p,{children:"When running with Docker, mount your service account file into the container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d --env-file .env -p 3333:3333 \\\n  -v /path/to/local/gcp/service-account-file.json:/tmp/service-account-file.json \\\n  storage-service:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"amazon-web-services-aws-s3",children:"Amazon Web Services (AWS S3)"}),"\n",(0,r.jsxs)(n.p,{children:["Update your ",(0,r.jsx)(n.code,{children:".env"})," file with AWS credentials:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=aws\nS3_REGION=ap-southeast-2\nAWS_ACCESS_KEY_ID=your-aws-access-key-id\nAWS_SECRET_ACCESS_KEY=your-aws-secret-access-key\nAVAILABLE_BUCKETS=documents,files\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then run the container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d --env-file .env -p 3333:3333 storage-service:latest\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For production deployments on AWS, consider using IAM roles instead of static credentials. See the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html",children:"AWS documentation"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"s3-compatible-providers",children:"S3-Compatible Providers"}),"\n",(0,r.jsxs)(n.p,{children:["Any S3-compatible storage provider can be used by setting ",(0,r.jsx)(n.code,{children:"STORAGE_TYPE=aws"})," and configuring a custom endpoint via ",(0,r.jsx)(n.code,{children:"S3_ENDPOINT"}),". The service uses the standard S3 API, so any provider that implements this API will work."]}),"\n",(0,r.jsx)(n.h3,{id:"minio",children:"MinIO"}),"\n",(0,r.jsx)(n.p,{children:"Ideal for local development and self-hosted deployments:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=aws\nS3_ENDPOINT=http://minio:9000\nS3_FORCE_PATH_STYLE=true\nAWS_ACCESS_KEY_ID=minioadmin\nAWS_SECRET_ACCESS_KEY=minioadmin\nAVAILABLE_BUCKETS=documents,files\n"})}),"\n",(0,r.jsx)(n.h3,{id:"digitalocean-spaces",children:"DigitalOcean Spaces"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=aws\nS3_ENDPOINT=https://syd1.digitaloceanspaces.com\nAWS_ACCESS_KEY_ID=your-do-access-key-id\nAWS_SECRET_ACCESS_KEY=your-do-secret-access-key\nAVAILABLE_BUCKETS=documents,files\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cloudflare-r2",children:"Cloudflare R2"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=aws\nS3_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com\nS3_FORCE_PATH_STYLE=true\nAWS_ACCESS_KEY_ID=your-r2-access-key-id\nAWS_SECRET_ACCESS_KEY=your-r2-secret-access-key\nAVAILABLE_BUCKETS=documents,files\n"})}),"\n",(0,r.jsx)(n.h2,{id:"s3-configuration-reference",children:"S3 Configuration Reference"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"S3_REGION"})}),(0,r.jsx)(n.td,{children:"Yes (for AWS S3)"}),(0,r.jsx)(n.td,{children:"AWS region. Not required when using a custom endpoint."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"S3_ENDPOINT"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Custom endpoint URL for S3-compatible providers."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"S3_FORCE_PATH_STYLE"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsxs)(n.td,{children:["Set to ",(0,r.jsx)(n.code,{children:"true"})," for path-style URLs (required for MinIO and Cloudflare R2)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"})}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Access key for authentication."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"})}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Secret key for authentication."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"custom-public-url-for-document-uris",children:"Custom Public URL for Document URIs"}),"\n",(0,r.jsx)(n.p,{children:"By default, each storage provider constructs public document URIs from its own endpoint:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AWS S3"}),": ",(0,r.jsx)(n.code,{children:"https://{bucket}.s3.amazonaws.com/{key}"})," or ",(0,r.jsx)(n.code,{children:"https://{bucket}.{endpoint}/{key}"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GCP"}),": ",(0,r.jsx)(n.code,{children:"https://{bucket}.storage.googleapis.com/{key}"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Local"}),": ",(0,r.jsx)(n.code,{children:"http://{domain}:{port}/{key}"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If you place a CDN or custom domain in front of your storage bucket, you can set ",(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," to override ",(0,r.jsx)(n.strong,{children:"only the URI returned to clients"}),". Uploads and all other storage operations are unaffected."]}),"\n",(0,r.jsx)(n.admonition,{title:"How it works",type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," changes ",(0,r.jsx)(n.strong,{children:"only"})," the URI returned in API responses. It does not affect where files are uploaded to or how the service communicates with your storage provider. The upload path remains unchanged. The response URI becomes: ",(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"PUBLIC_URL"}),"/key"]}),"."]})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," applies to ",(0,r.jsx)(n.code,{children:"aws"})," and ",(0,r.jsx)(n.code,{children:"gcp"})," storage types. It is ignored for ",(0,r.jsx)(n.code,{children:"local"})," storage."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PUBLIC_URL"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Base URL for public document URIs. When set, overrides the default URI for the configured storage provider."})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"example-digitalocean-spaces-with-cdn",children:"Example: DigitalOcean Spaces with CDN"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=aws\nS3_ENDPOINT=https://syd1.digitaloceanspaces.com\nAWS_ACCESS_KEY_ID=your-do-access-key-id\nAWS_SECRET_ACCESS_KEY=your-do-secret-access-key\nAVAILABLE_BUCKETS=documents,files\nPUBLIC_URL=https://documents.example.com\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-google-cloud-storage-with-cloud-cdn",children:"Example: Google Cloud Storage with Cloud CDN"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"STORAGE_TYPE=gcp\nGOOGLE_APPLICATION_CREDENTIALS=/tmp/service-account-file.json\nPUBLIC_URL=https://cdn.example.com\n"})}),"\n",(0,r.jsx)(n.p,{children:"In both configurations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Files are uploaded to the configured storage provider as normal"}),"\n",(0,r.jsxs)(n.li,{children:["The URI returned to clients uses ",(0,r.jsx)(n.code,{children:"PUBLIC_URL"}),": ",(0,r.jsx)(n.code,{children:"https://documents.example.com/{key}"})]}),"\n",(0,r.jsx)(n.li,{children:"Your CDN custom domain should be configured to serve content from the storage bucket"}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," is set, the bucket name is ",(0,r.jsx)(n.strong,{children:"not"})," included in the generated URI. This assumes your CDN or custom domain already points to a specific bucket. If you use multiple buckets (via ",(0,r.jsx)(n.code,{children:"AVAILABLE_BUCKETS"}),"), all generated URIs will share the same ",(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," base."]}),(0,r.jsxs)(n.p,{children:["Only the origin (protocol, hostname, and port) of ",(0,r.jsx)(n.code,{children:"PUBLIC_URL"})," is used. Any path component (e.g. ",(0,r.jsx)(n.code,{children:"https://cdn.example.com/subpath"}),") is ignored."]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var o=s(6540);const r={},i=o.createContext(r);function t(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);